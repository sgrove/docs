import Example from '~/components/example'
import { Code, InlineCode, RequestHeader } from '~/components/text/code'
import Note from '~/components/text/note'
import { GenericLink, HelpLink } from '~/components/text/link'
import { P, PDIV } from '~/components/text/paragraph'
import Request from '~/components/api/request'
import EndpointComponent from './endpointComponent.jsx'

## Deployments

### Create a New Deployment

<EndpointComponent method="POST" url="/v6/now/deployments" />

<Example>
<span>Example request with inlined files:</span>
<Request
  url="https://api.zeit.co/v6/now/deployments"
  method="POST"
  headers={{
  Authorization: `Bearer ${(props.testingToken ? props.testingToken.token : '$TOKEN')}`,
  'Content-Type': 'application/json'
  }}
  body={{
    "name": "my-instant-deployment",
    "version": 2,
    "files": [
      {
        "file": "index.html",
        "data": "<!doctype html>\n<html>\n  <head>\n    <title>A simple deployment with the Now API!</title>\n  </head>\n  <body>\n    <h1>Welcome to a simple static file</h1>\n    <p>Deployed with <a href=\"https://zeit.co/docs/api\">ZEIT&apos;s Now API</a>!</p>\n    </body>\n</html>"
      }
    ]
  }}
/>

</Example>

###### SHA1 files

In the case you want to first [upload each file](#endpoints/deployments/upload-deployment-files) and then create a deployment you need to pass the file name and the file content SHA1 which is going to be used to check the integrity and match the requests with the file.

<Note>
  <GenericLink href="#endpoints/deployments/upload-deployment-files">
    Uploading each file
  </GenericLink>{' '}
  and then creating the deployment with files using SHA1 strings is especially
  useful when uploading many, or big, files. This is helpful when retrying
  deployments without needing to upload the files again.
</Note>

| Key      | <HelpLink href="#api-basics/types" hasIcon>Type</HelpLink> | Required | Description                                                   |
| -------- | ---------------------------------------------------------- | -------- | ------------------------------------------------------------- |
| **file** | <HelpLink href="#api-basics/types">String</HelpLink>       | Yes      | The file name including the whole path, eg. `folder/file.js`. |
| **sha**  | <HelpLink href="#api-basics/types">String</HelpLink>       | Yes      | The file SHA1 used to check the integrity.                    |
| **size** | <HelpLink href="#api-basics/types">Integer</HelpLink>      | Yes      | The file size in bytes.                                       |

<Example>
<span>Example request:</span>
<Request
  url="https://api.zeit.co/v6/now/deployments"
  method="POST"
  headers={{
    Authorization: `Bearer ${(props.testingToken ? props.testingToken.token : '$TOKEN')}`,
    'Content-Type': 'application/json'
  }}
  body={{
    "name": "my-instant-deployment",
    "version": 2,
    "files": [
      {
        "file": "index.html",
        "sha": "6938e4ed47a23f17ceb6dbd880ab18d2787e7946",
        "size": 160
      }
    ]
  }}
/>

<span>Example successful (<P.B>200</P.B>) response:</span>
<Code lang="json">{`{
  "id": "dpl_6EZWg2tkQevMN76UQzFgKsD2gaNR",
  "url": "my-instant-deployment-2i7mwl1a1w.now.sh",
  "name": "my-instant-deployment",
  "meta": {},
  "plan": "unlimited",
  "public": false,
  "ownerId": "ZspSRT4ljIEEmMHgoDwKWDei",
  "readyState": "READY",
  "createdAt": 1540257237129,
  "createdIn": "sfo1",
  "regions": [
    "sfo1"
  ],
  "builds": [
    { "src": "**", "use": "@now/static" }
  ],
  "routes": null,
  "env": [],
  "build": {
    "env": []
  }
}`}</Code>
</Example>

#### Force a New Deployment

To create a new deployment, with a new ID and URL, etc. if nothing has changed with the files intended to be deployed that were already previously deployed, use the `forceNew=1` URL parameter.

<Example>
<P.B>Example First Deployment</P.B>

<PDIV>Request:</PDIV>
<Request
  method="POST"
  url="https://api.zeit.co/v6/now/deployments"
  headers={{
    Authorization: `Bearer ${(props.testingToken ? props.testingToken.token : '$TOKEN')}`,
    'Content-Type': 'application/json'
  }}
  body={{
    "name": "my-instant-deployment",
    "version": 2,
    "files": [
      { "file": "index.html", "data": "<!doctype html>\n<html>\n  <head>\n    <title>A simple deployment with the Now API!</title>\n  </head>\n  <body>\n    <h1>Welcome to a simple static file</h1>\n    <p>Deployed with <a href=\"https://zeit.co/docs/api\">ZEIT&apos;s Now API</a>!</p>\n    </body>\n</html>" }
    ]
  }}
/>

<PDIV>Successful Response:</PDIV>
<Code lang="json">{`{
  "id": "dpl_D6FpCMUYdba5bZFJvA46FLBMxM2W",
  "url": "my-instant-deployment-3ij3cxz9qr.now.sh",
  "name": "my-instant-deployment",
  "meta": {},
  "plan": "unlimited",
  "public": false,
  "ownerId": "ZspSRT4ljIEEmMHgoDwKWDei",
  "readyState": "READY",
  "createdAt": 1540257237129,
  "createdIn": "sfo1",
  "regions": [
    "sfo1"
  ],
  "builds": [
    { "src": "**", "use": "@now/static" }
  ],
  "routes": null,
  "env": [],
  "build": {
    "env": []
  }
}`}</Code>

<P.B>Deploying again with the same request would yield the same response</P.B>, with the same ID and URL due to no differences to the files or configuration.

<P.B>Example Second Deployment using <InlineCode>?forceNew=1</InlineCode></P.B>
<P>Request:</P>
<Request
  method="POST"
  url="https://api.zeit.co/v6/now/deployments?forceNew=1"
  headers={{
    Authorization: `Bearer ${(props.testingToken ? props.testingToken.token : '$TOKEN')}`,
    'Content-Type': 'application/json'
  }}
  body={{
    "name": "my-instant-deployment",
    "version": 2,
    "files": [
      { "file": "index.html", "data": "<!doctype html>\n<html>\n  <head>\n    <title>A simple deployment with the Now API!</title>\n  </head>\n  <body>\n    <h1>Welcome to a simple static file</h1>\n    <p>Deployed with <a href=\"https://zeit.co/docs/api\">ZEIT&apos;s Now API</a>!</p>\n    </body>\n</html>" }
    ]
  }}
/>

<P.B>Deploying again with the same request using the <InlineCode>?forceNew=1</InlineCode> URL parameter would yield a new, different, response</P.B>, with a different ID and URL:
<Code lang="json">{`{
  "id": "dpl_5bQis7iG8EQxJMAEY92KxsE4WmQZ",
  "url": "my-instant-deployment-613cx07atx.now.sh",
  "name": "my-instant-deployment",
  "meta": {},
  "plan": "unlimited",
  "public": false,
  "ownerId": "ZspSRT4ljIEEmMHgoDwKWDei",
  "readyState": "READY",
  "createdAt": 1540257454135,
  "createdIn": "sfo1",
  "regions": [
    "sfo1"
  ],
  "builds": [
    { "src": "**", "use": "@now/static" }
  ],
  "routes": null,
  "env": [],
  "build": {
    "env": []
  }
}`}</Code>
</Example>

#### Response Parameters

| Key            | <HelpLink href="#api-basics/types" hasIcon>Type</HelpLink> | Description                                                                                                                                                                                               |
| -------------- | ---------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **id**         | <HelpLink href="#api-basics/types">String</HelpLink>       | A String holding the unique ID of the deployment.                                                                                                                                                         |
| **url**        | <HelpLink href="#api-basics/types">String</HelpLink>       | A string with the unique URL of the deployment. If it hasn't finished uploading (is incomplete), the value will be `null`.                                                                                |
| **name**       | <HelpLink href="#api-basics/types">String</HelpLink>       | The name of the deployment.                                                                                                                                                                               |
| **version**    | <HelpLink href="#api-basics/types">Integer</HelpLink>      | The Now platform version the deployment is associated to.                                                                                                                                                 |
| **regions**    | <HelpLink href="#api-basics/types">List</HelpLink>         | The regions the deployment exists in, e.g. `sfo1`.                                                                                                                                                        |
| **routes**     | <HelpLink href="#api-basics/types">List</HelpLink>         | A list of routes objects used to rewrite paths to point towards other internal or external paths. For example; `[{ "src": "/docs", "dest": "https://docs.zeit.co" }]`.                                    |
| **builds**     | <HelpLink href="#api-basics/types">List</HelpLink>         | A list of objects containing the Builds for a particular set of sources in the deployment. Each object contains a `src` and `use` describing the sources files that use Builds in the deployment.         |
| **plan**       | <HelpLink href="#api-basics/types">String</HelpLink>       | The pricing plan the deployment was made under.                                                                                                                                                           |
| **public**     | <HelpLink href="#api-basics/types">Boolean</HelpLink>      | A Boolean representing if the deployment is public or not. By default this is `false`.                                                                                                                    |
| **ownerId**    | <HelpLink href="#api-basics/types">String</HelpLink>       | The unique ID of the user or team the deployment belongs to.                                                                                                                                              |
| **readyState** | <HelpLink href="#api-basics/types">Enum</HelpLink>         | The state of the deployment depending on the process of deploying, or if it is ready or in an error state. Possible values are `INITIALIZING`, `ANALYZING`, `BUILDING`, `DEPLOYING`, `READY`, or `ERROR`. |
| **createdAt**  | <HelpLink href="#api-basics/types">Date</HelpLink>         | A number containing the date when the deployment was created in milliseconds.                                                                                                                             |
| **createdIn**  | <HelpLink href="#api-basics/types">String</HelpLink>       | The region where the deployment was first created, e.g. `sfo1`.                                                                                                                                           |

<Example>
<span>Example request:</span>
<Request
  method="POST"
  url="https://api.zeit.co/v6/now/deployments"
  headers={{
    Authorization: `Bearer ${(props.testingToken ? props.testingToken.token : '$TOKEN')}`,
    'Content-Type': 'application/json'
  }}
  body={{
    "name": "my-instant-deployment",
    "version": 2,
    "files": [
      { "file": "index.html", "data": "<!doctype html>\n<html>\n  <head>\n    <title>A simple deployment with the Now API!</title>\n  </head>\n  <body>\n    <h1>Welcome to a simple static file</h1>\n    <p>Deployed with <a href=\"https://zeit.co/docs/api\">ZEIT&apos;s Now API</a>!</p>\n    </body>\n</html>" }
    ]
  }}
/>

<span>Example successful (<P.B>200</P.B>) response:</span>
<Code lang="json">{`{
  "id": "dpl_89qyp1cskzkLrVicDaZoDbjyHuDJ",
  "url": "my-instant-deployment-3ij3cxz9qr.now.sh",
  "name": "my-instant-deployment",
  "meta": {},
  "plan": "unlimited",
  "public": false,
  "ownerId": "ZspSRT4ljIEEmMHgoDwKWDei",
  "readyState": "READY",
  "createdAt": 1540257589405,
  "createdIn": "sfo1",
  "regions": [
    "sfo1"
  ],
  "builds": [
    { "src": "**", "use": "@now/static" }
  ],
  "routes": null,
  "env": [],
  "build": {
    "env": []
  }
}`}</Code>
</Example>

### Upload Deployment Files

<EndpointComponent method="POST" url="/v2/now/files" />

<Example>
  <span>Example request:</span>

  <Request
    method="POST"
    url="https://api.zeit.co/v2/now/files"
    headers={{
      Authorization: `Bearer ${(props.testingToken ? props.testingToken.token : '$TOKEN')}`,
      'x-now-digest': '6938e4ed47a23f17ceb6dbd880ab18d2787e7946'
    }}
    body="<!doctype html>
<html>\n
  <head>\n
    <title>My Instant Deployment</title>\n
  </head>\n
  <body>\n
    &nbsp;<h1>My Instant Now Deployment</h1>\n
    <p>Hello world!</p>\n
  </body>
</html>
"
  />
</Example>

### List Deployments

<EndpointComponent method="GET" url="/v3/now/deployments" />

### Delete a Deployment

<EndpointComponent method="DELETE" url="/v6/now/deployments/:id" />

<Example>
  <PDIV>Example request:</PDIV>

<Request
  method="DELETE"
  url="https://api.zeit.co/v5/now/deployments/dpl_5WJWYSyB7BpgTj3EuwF37WMRBXBtPQ2iTMJHJBJyRfd"
  headers={{
    Authorization: `Bearer ${
      props.testingToken ? props.testingToken.token : '$TOKEN'
    }`
  }}
/>

<PDIV>Example response:</PDIV>
<Code lang="json">{`{
  "uid": "dpl_5WJWYSyB7BpgTj3EuwF37WMRBXBtPQ2iTMJHJBJyRfd",
  "state": "DELETED"
}`}</Code>
</Example>

### List Deployment Files

<EndpointComponent method="GET" url="/v5/now/deployments/:id/files" />

<Example>
  <PDIV>Example request:</PDIV>

<Request
  url="https://api.zeit.co/v5/now/deployments/dpl_BRGyoU2Jzzwx7myBnqv3xjRDD2GnHTwUWyFybnrUvjDD/files"
  headers={{
    Authorization: `Bearer ${
      props.testingToken ? props.testingToken.token : '$TOKEN'
    }`
  }}
/>

Example successful (**200**) response:

<Code lang="json">{`[
  {
    "name": "index.html",
    "type": "file",
    "mode": 33206,
    "uid": "6938e4ed47a23f17ceb6dbd880ab18d2787e7946"
  },
  {
    "name": "static",
    "type": "directory",
    "mode": 16749,
    "children": [
      {
        "name": "logo.png",
        "type": "file",
        "mode": 33188,
        "uid": "c11e3ce950b69b959fcd691df973143271647714"
      }
    ]
  }
]`}</Code>
</Example>

### Get Single File Contents

<EndpointComponent method="GET" url="/v5/now/deployments/:id/files/:fileId" />

<Example>
  <PDIV>Example request:</PDIV>

<Request
  url="https://api.zeit.co/v6/now/deployments/dpl_BRGyoU2Jzzwx7myBnqv3xjRDD2GnHTwUWyFybnrUvjDD/files/2d4aad419917f15b1146e9e03ddc9bb31747e4d0"
  headers={{
    Authorization: `Bearer ${
      props.testingToken ? props.testingToken.token : '$TOKEN'
    }`
  }}
/>

Example successful (**200**) response:

<Code lang="html">{`<!doctype html>
<html>
 <head>
 <title>My Instant Deployment</title>
 </head>
 <body>
 <h1>My Instant Now Deployment</h1>
 <p>Hello world!</p>
 </body>
</html>`}</Code>
</Example>

### List Builds

<EndpointComponent method="GET" url="/v5/now/deployments/:id/builds" />

<Example>
  <span>Example Request:</span>
  <Request
    url="https://api.zeit.co/v6/now/deployments/dpl_BRGyoU2Jzzwx7myBnqv3xjRDD2GnHTwUWyFybnrUvjDD/builds"
    headers={{
      Authorization: `Bearer ${
        props.testingToken ? props.testingToken.token : '$TOKEN'
      }`
    }}
  />
  <span>
    Example Successful (<P.B>200</P.B>) response:
  </span>
  <Code lang="json">{`{
  "builds": [
    {
      "id": "hdl_kxfdc1962",
      "use": "@now/static",
      "config": {},
      "createdIn": "sfo1",
      "deployedTo": [],
      "readyState": "READY",
      "readyStateAt": 1540095775941,
      "path": "index.html"
    }
  ]
}`}</Code>
</Example>
